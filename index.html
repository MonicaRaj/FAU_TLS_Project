<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Visualization of FAU Upgrades over time (2007 to 2017)</title>

    <style>
      html,
      body {
        padding: 0;
        margin: 0;
        height: 100%;
        font-family: Arial;
        overflow: hidden;
        outline: none;
        border: none;
      }

      div{
        outline: none;
        border: none;
      }

    /* Header/Logo Title */
    .header {
        padding: 1px;
        text-align: center;
        background: #1abc9c;
        color: white;
        font-size: 10px;
        height: 7%;
    }

    .table {
        padding: 1px;
        text-align: center;
        background: #040104;
        color: white;
        font-size: 10px;
        height: 8%;
        width: 100%;
    }

    table {
        padding: 1px;
        width: 100%;
        outline: ivory;
    }

    td {
         border: 1px solid ivory;
    }

      #paneDiv {
        padding: 12px;
        background-color: rgba(255, 255, 255, 0.9);
        border: 1px solid white;
        color: black;
      }

      #slidesDiv{
        background-color: white;
        opacity: 0.9;
        color: black;
        padding: 10px;
        visibility: hidden;
        bottom: 20px;
        overflow-y: auto;
        text-align: center;
        height: 260px;
        width: 160px;
      }

      #slidesDiv .slide{
        /* Show cursor as pointer when on a slide */
        cursor: pointer;
        margin-bottom: 6px;
      }

      #slidesDiv .slide .title{
        /* Center the title text */
        text-align: center;
      }
      /* Draw active slide with a nice border around the thumbnail */

      #slidesDiv .slide.active img {
        box-shadow: 0px 0px 12px black;
        border-style: solid;
        border-width: thin;
        border-color: black;
      }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.18/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.18/"></script>

    <script>
      require(["esri/Map", 
      "esri/views/MapView", 
      "esri/views/SceneView",
      "esri/widgets/LayerList",
      "esri/layers/PointCloudLayer",
      "esri/WebScene",
        "esri/webscene/Slide",
        "esri/smartMapping/renderers/color",
        "esri/smartMapping/renderers/type",
        "esri/widgets/Legend",
        "esri/widgets/Expand",
        "esri/core/promiseUtils"], function (Map, MapView, SceneView,
        LayerList, PointCloudLayer,
        WebScene, Slide, colorRendererCreator, 
        typeRendererCreator, Legend,
        Expand, promiseUtils) {

        // var map = new Map({
        //   basemap: "satellite"
        // });

        // var pcLayer = new PointCloudLayer({
        //   url: "https://tiles.arcgis.com/tiles/V4Rx2DXlIHdEvTZA/arcgis/rest/services/FAU_RGB/SceneServer"
        // });
        // map.add(pcLayer);

        var scene2017 = new WebScene({
          portalItem: {
            // autocasts as new PortalItem()
            id: "b866fc088fa640cca41e963b96130cdf"
          }
        });

        var scene2007 = new WebScene({
          portalItem: {
            // autocasts as new PortalItem()
            id: "8749637ba96444c3b7c29e089fc4a866"
          }
        });

        /*********************************************************************
         * Reference the WebScene in a SceneView instance.
         *********************************************************************/
        var view1 = new SceneView({
          map: scene2007,
          container: "view1Div",
          popup: {
            defaultPopupTemplateEnabled: true // activate popup with defaut template
          }
        });

        // view1.ui.add(["slidesDiv"], "top-right");

        var view2 = new SceneView({
          map: scene2017,
          container: "view2Div",
          popup: {
            defaultPopupTemplateEnabled: true // activate popup with defaut template
          }
        });

    
        const slideExpand = new Expand({
          view: view2,
          content: document.getElementById("slidesDiv"),
          expanded: true
        });
        view2.ui.add(slideExpand, "top-right");

       

        // create a layerlist and expand widget and add to the view
        const layerList1 = new LayerList({
          view: view1
        });
        const llExpand1 = new Expand({
          view: view1,
          content: layerList1,
          expanded: false
        });
        view1.ui.add(llExpand1, "bottom-left");

         // create a layerlist and expand widget and add to the view
         const layerList2 = new LayerList({
          view: view2
        });
        const llExpand2 = new Expand({
          view: view2,
          content: layerList2,
          expanded: false
        });
        view2.ui.add(llExpand2, "bottom-right");

         function createSlideUI(slide, placement) {
          var slideElement = document.createElement("div");
          slideElement.id = slide.id;
          slideElement.classList.add("slide");

          var slidesDiv = document.getElementById("slidesDiv");
          if (placement === "first") {
            slidesDiv.insertBefore(slideElement, slidesDiv.firstChild);
          } else {
            slidesDiv.appendChild(slideElement);
          }

          var title = document.createElement("div");
          title.innerText = slide.title.text;
          slideElement.appendChild(title);

          var img = new Image();
          img.src = slide.thumbnail.url;
          img.title = slide.title.text;
          slideElement.appendChild(img);

          slideElement.addEventListener("click", function() {
            var slides = document.querySelectorAll(".slide");
            Array.from(slides).forEach(function(node) {
              node.classList.remove("active");
            });

            slideElement.classList.add("active");

            slide.applyTo(view2);
          });
        }

       

        view2.when(function() {
        
        document.getElementById("slidesDiv").style.visibility = "visible";

        var slides = scene2017.presentation.slides;

        slides.forEach(createSlideUI);
      });

       
        const views = [view1, view2];
        let active;

        const sync = (source) => {
          if (!active || !active.viewpoint || active !== source) {
            return;
          }

          for (const view of views) {
            if (view !== active) {
              view.viewpoint = active.viewpoint;
            }
          }
        };

        for (const view of views) {
          view.watch(["interacting", "animation"], () => {
            active = view;
            sync(active);
          });

          view.watch("viewpoint", () => sync(view));
        }
      });
    </script>
  </head>

  <body>
     <div class="header">
        <h1>Visualization of FAU Upgrades over time (2007 to 2017)</h1>
      </div>
    <div class="table">
        <table>
            <tr>
                <td>
                    <h1>FAU - 2007</h1>
                </td>
                <td>
                    <h1>FAU - 2017</h1>
                </td>
            </tr>
        </table>
    </div>
    <div id="view1Div" style="float: left; width: 50%; height: 85%; border: 1px solid black;"></div>
     
    <div id="view2Div" style="float: left; width: 49.5%; height: 85%; border: 1px solid black;"></div>
    <div id="slidesDiv" class="esri-widget"></div>
  </body>

</html>
